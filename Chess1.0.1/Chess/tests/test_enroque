import sys
import os
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

import unittest
from chess_game.game import Game
from chess_game.constants import White, Black
from chess_game.board import newBoard
from chess_game.Pieces import King, Rook

class TestCastling(unittest.TestCase):

    def setUp(self):
        self.width = 680
        self.height = 680
        self.rows = 8
        self.cols = 8
        self.square = self.width // self.cols
        self.game = Game(self.width, self.height, self.rows, self.cols, self.square, None)

    def test_kingside_castling_white(self):
        # Preparar el tablero para enroque corto blanco
        self.game.Board.Board[7][4] = King(self.square, None, White, "King", 7, 4)
        self.game.Board.Board[7][7] = Rook(self.square, None, White, "Rook", 7, 7)
        self.game.Board.Board[7][5] = 0
        self.game.Board.Board[7][6] = 0

        # Realizar el enroque corto
        self.game.selected = self.game.Board.Board[7][4]
        self.game.valid_moves = [(7, 6)]
        self.game._move(7, 6)

        # Verificar las posiciones del rey y la torre después del enroque corto
        self.assertIsInstance(self.game.Board.get_piece(7, 6), King)
        self.assertIsInstance(self.game.Board.get_piece(7, 5), Rook)

    def test_queenside_castling_white(self):
        # Preparar el tablero para enroque largo blanco
        self.game.Board.Board[7][4] = King(self.square, None, White, "King", 7, 4)
        self.game.Board.Board[7][0] = Rook(self.square, None, White, "Rook", 7, 0)
        self.game.Board.Board[7][1] = 0
        self.game.Board.Board[7][2] = 0
        self.game.Board.Board[7][3] = 0

        # Realizar el enroque largo
        self.game.selected = self.game.Board.Board[7][4]
        self.game.valid_moves = [(7, 2)]
        self.game._move(7, 2)

        # Verificar las posiciones del rey y la torre después del enroque largo
        self.assertIsInstance(self.game.Board.get_piece(7, 2), King)
        self.assertIsInstance(self.game.Board.get_piece(7, 3), Rook)

    def test_kingside_castling_black(self):
        # Preparar el tablero para enroque corto negro
        self.game.Board.Board[0][4] = King(self.square, None, Black, "King", 0, 4)
        self.game.Board.Board[0][7] = Rook(self.square, None, Black, "Rook", 0, 7)
        self.game.Board.Board[0][5] = 0
        self.game.Board.Board[0][6] = 0

        # Realizar el enroque corto
        self.game.selected = self.game.Board.Board[0][4]
        self.game.valid_moves = [(0, 6)]
        self.game._move(0, 6)

        # Verificar las posiciones del rey y la torre después del enroque corto
        self.assertIsInstance(self.game.Board.get_piece(0, 6), King)
        self.assertIsInstance(self.game.Board.get_piece(0, 5), Rook)

    def test_queenside_castling_black(self):
        # Preparar el tablero para enroque largo negro
        self.game.Board.Board[0][4] = King(self.square, None, Black, "King", 0, 4)
        self.game.Board.Board[0][0] = Rook(self.square, None, Black, "Rook", 0, 0)
        self.game.Board.Board[0][1] = 0
        self.game.Board.Board[0][2] = 0
        self.game.Board.Board[0][3] = 0

        # Realizar el enroque largo
        self.game.selected = self.game.Board.Board[0][4]
        self.game.valid_moves = [(0, 2)]
        self.game._move(0, 2)

        # Verificar las posiciones del rey y la torre después del enroque largo
        self.assertIsInstance(self.game.Board.get_piece(0, 2), King)
        self.assertIsInstance(self.game.Board.get_piece(0, 3), Rook)

if __name__ == "__main__":
    unittest.main()